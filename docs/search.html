<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Search Music</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>

  <body class="bg-light">
    <div class="container mt-4">
      <!-- Welcome -->
      <div
        class="d-flex align-items-center mb-4 p-4 bg-white rounded shadow-sm"
      >
        <img
          id="userAvatar"
          class="rounded-circle me-3"
          width="70"
          height="70"
        />
        <div>
          <h4 class="mb-0">Hello <span id="welcomeName"></span> ğŸ‘‹</h4>
          <small class="text-muted"
            >Discover and save your favorite music</small
          >
        </div>
      </div>

      <!-- Search -->
      <div class="card p-3 shadow-sm mb-4">
        <div class="input-group input-group-lg">
          <input
            type="text"
            id="searchInput"
            class="form-control"
            placeholder="Search for a song or artistâ€¦"
          />
          <button class="btn btn-primary px-4" id="searchBtn">ğŸ” Search</button>
        </div>
      </div>

      <!-- Results -->
      <div id="results" class="row g-4"></div>
    </div>

    <!-- PLAYER MODAL -->
    <div class="modal fade" id="playerModal" tabindex="-1">
      <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-body">
            <iframe
              id="playerFrame"
              width="100%"
              height="500"
              frameborder="0"
              allowfullscreen
            ></iframe>
          </div>
        </div>
      </div>
    </div>

    <!-- ADD TO PLAYLIST MODAL -->
    <div class="modal fade" id="playlistModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content p-3">
          <h5 class="mb-2">Add to Playlist</h5>
          <p class="text-muted mb-3" id="modalVideoTitle"></p>

          <!-- Existing playlist -->
          <div class="mb-3">
            <div class="form-check">
              <input
                class="form-check-input"
                type="radio"
                name="playlistMode"
                id="modeExisting"
                checked
              />
              <label class="form-check-label fw-semibold" for="modeExisting">
                Add to existing playlist
              </label>
            </div>

            <select id="playlistSelect" class="form-select mt-2"></select>
          </div>

          <hr />

          <!-- New playlist -->
          <div class="mb-3">
            <div class="form-check">
              <input
                class="form-check-input"
                type="radio"
                name="playlistMode"
                id="modeNew"
              />
              <label class="form-check-label fw-semibold" for="modeNew">
                Create new playlist
              </label>
            </div>

            <input
              type="text"
              id="newPlaylistName"
              class="form-control mt-2"
              placeholder="New playlist name"
              disabled
            />
          </div>

          <div class="d-flex justify-content-end gap-2">
            <button class="btn btn-secondary" data-bs-dismiss="modal">
              Cancel
            </button>
            <button class="btn btn-success" id="saveToPlaylist">Save</button>
          </div>

          <div id="alreadyExistsMsg" class="text-warning mt-3 d-none">
            âš  This song already exists in one of your playlists.
          </div>
        </div>
      </div>
    </div>

    <!-- TOAST -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
      <div id="saveToast" class="toast">
        <div class="toast-body">
          Saved to playlist.
          <a href="playlists.html" class="text-decoration-underline">
            Go to playlists
          </a>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script src="js/auth.js"></script>
    <script src="js/search.js"></script>

    <script>
      requireAuth();
      loadNavbar();
      blockBackNavigation();
    </script>
  </body>
</html>
